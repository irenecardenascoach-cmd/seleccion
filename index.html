<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ProQOL-5 | Selección (Privado)</title>
  <style>
    body{font-family:system-ui,Arial;margin:0;background:#f6f7fb}
    .wrap{max-width:900px;margin:30px auto;background:#fff;padding:20px;border-radius:12px}
    h1{margin-top:0}
    fieldset{border:1px solid #ddd;border-radius:10px;margin-bottom:12px;padding:12px}
    legend{font-weight:600}
    .likert label{margin-right:10px}
    button{padding:12px 16px;border-radius:10px;border:none;font-weight:600}
    .ok{background:#e8fff0;padding:12px;border-radius:10px}
    .warn{background:#fff3cd;padding:12px;border-radius:10px}
  </style>
</head>

<body>
<div class="wrap">
  <h1>ProQOL-5</h1>
  <p>Responde según los <b>últimos 30 días</b>. Escala 1–5.</p>

  <form id="form">
    <label>Nombre<br>
      <input id="nombre" required style="width:100%;padding:8px">
    </label><br><br>

    <label>Email (opcional)<br>
      <input id="correo" type="email" style="width:100%;padding:8px">
    </label><br><br>

    <div id="preguntas"></div>

    <button type="submit">Enviar</button>
  </form>

  <div id="msg"></div>
</div>

<script>
/* ================== CONFIGURACIÓN ================== */
const APPS_SCRIPT_WEBAPP_URL = "PEGA_AQUI_TU_URL_EXEC";
const ADMIN_KEY = "Ire_2026";
/* ================================================== */

const ITEMS = [
 "Me siento feliz.",
 "Me preocupo por más de una persona a la que ayudo.",
 "Siento satisfacción al poder ayudar a otras personas.",
 "Me siento conectado/a con los demás.",
 "Me sobresalto o me altero ante ruidos inesperados.",
 "Me siento con energía después de trabajar con las personas a las que ayudo.",
 "Me resulta difícil separar mi vida personal de mi vida laboral.",
 "No soy tan productivo/a porque pierdo sueño por historias traumáticas.",
 "Creo que he sido afectado/a por el estrés traumático de otros.",
 "Me siento atrapado/a por mi trabajo.",
 "Me he sentido en tensión o alerta.",
 "Me gusta mi trabajo.",
 "Me siento deprimido/a por las experiencias de otros.",
 "Siento que revivo el trauma de alguien.",
 "Tengo creencias que me sostienen.",
 "Estoy satisfecho/a con mi actualización profesional.",
 "Soy la persona que siempre quise ser.",
 "Mi trabajo me da satisfacción.",
 "Me siento agotado/a.",
 "Tengo pensamientos positivos sobre ayudar.",
 "Mi carga laboral parece interminable.",
 "Creo que marco una diferencia.",
 "Evito cosas que me recuerdan traumas.",
 "Me siento orgulloso/a de ayudar.",
 "Tengo pensamientos intrusivos.",
 "Me siento bloqueado/a por el sistema.",
 "Me considero exitoso/a.",
 "No recuerdo partes importantes del trabajo con trauma.",
 "Soy una persona compasiva.",
 "Estoy satisfecho/a con haber elegido este trabajo."
];

const REVERSE = new Set([1,4,15,17,29]);
const SUB = {
 CS:[3,6,12,16,18,20,22,24,27,30],
 BO:[1,4,8,10,15,17,19,21,26,29],
 STS:[2,5,7,9,11,13,14,23,25,28]
};

const cont = document.getElementById("preguntas");
ITEMS.forEach((t,i)=>{
  cont.innerHTML += `
   <fieldset>
    <legend>${i+1}. ${t}</legend>
    ${[1,2,3,4,5].map(v=>`
      <label><input type="radio" name="q${i+1}" value="${v}" required> ${v}</label>
    `).join("")}
   </fieldset>`;
});

function score(ans){
  const s = ans.map((v,i)=>REVERSE.has(i+1)?6-v:v);
  const sum = a=>a.reduce((t,i)=>t+s[i-1],0);
  const lvl = x=>x<=22?"Bajo":x>=42?"Alto":"Promedio";
  return {
    sums:{
      CS:sum(SUB.CS),
      BO:sum(SUB.BO),
      STS:sum(SUB.STS)
    },
    levels:{
      CS:lvl(sum(SUB.CS)),
      BO:lvl(sum(SUB.BO)),
      STS:lvl(sum(SUB.STS))
    }
  };
}

document.getElementById("form").onsubmit = async e=>{
  e.preventDefault();
  const ans=[];
  for(let i=1;i<=30;i++){
    ans.push(+document.querySelector(`input[name=q${i}]:checked`).value);
  }

  const r = score(ans);

  const payload = {
    key: ADMIN_KEY,
    timestamp: new Date().toISOString(),
    candidate:{
      nombre: nombre.value,
      correo: correo.value
    },
    answers_raw: ans,
    sums: r.sums,
    levels: r.levels,
    internal_flag:{
      attention:(r.levels.BO==="Alto"||r.levels.STS==="Alto")?"ALERTA":"OK"
    }
  };

  await fetch(APPS_SCRIPT_WEBAPP_URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });

  document.getElementById("msg").innerHTML =
    "<div class='ok'><b>Formulario enviado correctamente.</b></div>";
  e.target.reset();
};
</script>
</body>
</html>
